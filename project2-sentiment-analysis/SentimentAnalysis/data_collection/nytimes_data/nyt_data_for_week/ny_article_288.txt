WASHINGTON — President Trump, hours after threatening to veto a $1.3 trillion spending bill and throwing the capital into turmoil, signed it into law on Friday, yielding to advisers and Republican leaders who urged him against manufacturing a government shutdown crisis.Even as he signed the bill, the president seethed about being forced to swallow legislation that broadly repudiated an agenda that once foresaw the reshaping of the federal government into his “America First” image.Enactment of the bipartisan spending package, which had seemed like a certainty at dawn, brought an end to hours of chaos at the White House, where Mr. Trump surprised his advisers — and Republican congressional leaders — with an angry morning tweet threatening to sink a measure that his aides had already promised he would sign.His stated reason was its lack of funding for his promised border wall, but that was only one disappointment for the president in a measure that blocked the hiring of thousands of new border patrol agents; stopped deep cuts to foreign aid, the diplomatic corps and environmental programs; thwarted a push to fund vouchers for private and parochial schools; and even rescued the National Endowments for the Arts and the Humanities.“There are a lot of things that I’m unhappy about in this bill,” Mr. Trump said during a hastily called event at the White House, where the president placed his hand on a foot-high copy of the 2,232-page bill he said he had just signed. “There are a lot of things that we shouldn’t have had in this bill. But we were, in a sense, forced — if we want to build our military — we were forced to have. There are some things that we should have in the bill.”In a rambling and disjointed statement from the Diplomatic Reception Room, Mr. Trump called the process that yielded the legislation “this ridiculous situation,” and he warned, “I will never sign another bill like this again — I’m not going to do it again.”The dramatic denouement for the spending bill, which drew fury from Mr. Trump’s core supporters, left both political parties in Washington reeling and some of his own aides bewildered about the president’s contradictory actions. Yet it was only the latest instance of Mr. Trump chafing against the advice of his advisers and throwing his own brand of chaos into the gears of the federal government.Mr. Trump’s grudging embrace only highlighted the degree to which a president who portrays himself as the ultimate dealmaker has been sidelined by congressional leaders in both parties when it comes to striking compromises to fund the core functions of government. Instead, Mr. Trump has proved unable to find a way to negotiate victories on some of his highest priorities.Ardent conservatives who are Mr. Trump’s core backers were left wondering aloud whether the president’s capitulation and failures would imperil Republicans’ chances of keeping control of Congress in the midterm elections this fall. Amy Kremer, a Tea Party activist who helped founded Women for Trump, tweeted, “I’m done.”“Democrats just won November #midterms. No point in wasting my time between now and then,” Ms. Kremer wrote.Mr. Trump said the spending plan was important because it includes hundreds of billions of dollars in military spending to ensure that the United States has “by far the strongest military in the world.”“We had no choice but to fund our military,” Mr. Trump declared, reading aloud a series of military programs and weapons systems in the spending bill, including submarines, missile defense systems, tanks, helicopters and warships.But in a bizarre version of the usually upbeat bill-signing ceremonies at the White House, Mr. Trump then went on to denigrate the legislation as “crazy.”“Nobody read it,” Mr. Trump said of the gargantuan funding measure drawn up by Republican and Democratic leaders in the House and the Senate. Echoing criticism from those who voted against it, Mr. Trump added, “It’s only hours old.”He urged lawmakers to avoid passage of another so-called omnibus bill and to instead pass legislation giving him a line-item veto of spending measures, something that the Supreme Court has already ruled to be unconstitutional. He also called on the Senate to eliminate filibusters.“I looked very seriously at the veto,” Mr. Trump told reporters. “I was thinking about doing the veto.”If he had, it would almost certainly have shut down the government at midnight, just as hundreds of thousands of teenagers and adults were scheduled to descend on Washington for a gun control march on Saturday. With Congress on spring recess for two weeks starting Monday, many lawmakers had already departed Washington and some were on their way out of the country as part of official congressional delegations.The spending measure cleared Congress early Friday morning and, while Mr. Trump had made plain he was unhappy with some aspects of it, his senior advisers spent Thursday telling reporters that he would sign it. Then early Friday, on a morning when he watched a fierce backlash to the measure play out on Fox News, Mr. Trump seemed to hesitate, tweeting angrily about the lack of wall funding.“I am considering a VETO of the Omnibus Spending Bill based on the fact that the 800,000 plus DACA recipients have been totally abandoned by the Democrats (not even mentioned in Bill) and the BORDER WALL, which is desperately needed for our National Defense, is not fully funded,” Mr. Trump wrote.He was referring partly to the fact that he failed to reach a deal with Democrats to include provisions in the spending measure that would preserve Deferred Action for Childhood Arrivals, or DACA, an Obama-era program that Mr. Trump rescinded last fall. The program allows undocumented immigrants brought to the United States as children to apply for permits to work legally and avoid deportation.But the president was most angry about the lack of funding in the bill for an enormous wall across the nation’s southern border that he has billed as the centerpiece of his crackdown on illegal immigration. The measure includes nearly $1.6 billion for border security, including new technology and repairs to existing barriers — but not Mr. Trump’s wall, as he claimed on Twitter on Wednesday.It provides $641 million for about 33 miles of new fencing, but prohibits building a concrete structure or other prototypes the president has considered.Mr. Trump’s morning tweet set off a scramble on Capitol Hill and at the White House. Speaker Paul D. Ryan, Republican of Wisconsin, phoned Mr. Trump and encouraged him to sign the measure, according to a source familiar with the call, citing all the “wins” contained in the bill, especially for the military.The president’s top advisers rushed to bring in Jim Mattis, the secretary of defense, to make the case to Mr. Trump that he must sign the legislation because of its robust military funding. Within hours, Mr. Mattis was in the Oval Office with Mr. Trump telling him the level of military spending was “historic,” according to a senior White House official. Vice President Mike Pence, who had postponed a trip to deal with the crisis, also chimed in to make a case for signing the bill.The president relented. In his remarks not long after, Mr. Trump expressed disappointment and said he was “not happy” that the bill did not allocate the full $25 billion that the administration had requested for the wall. But he sought to claim some measure of victory, saying that $1.6 billion “does start the wall” and promising to “make that $1.6 billion go very, very far.”The political whiplash that he had put Washington through was reflected in Mr. Trump’s own comments. At times, he seemed to direct blame for the spending bill on Republican lawmakers. But later, he praised them for doing their best in a tough situation.“I just want to thank members of Congress for working so hard,” he said. “There are a lot of strings pulling everyone in different directions.”The president’s threat came as a surprise but hardly a shock to Republican leaders, who spent much of a snowy Wednesday privately imploring an agitated Mr. Trump to put aside his objections and back the measure, claiming it as a win.Sensing a political advantage, Democrats were unperturbed by Mr. Trump’s veto threat fire drill. Top Democratic aides said on Friday morning that they would not make concessions to Mr. Trump if he chose to reject the legislation, but lawmakers stayed silent until the president signed the bill. Then they cheered the measure as a disavowal of Mr. Trump’s ideas.“In sharp contrast to the devastating cuts called for in the Trump budget, the omnibus contains robust funding to combat homelessness, create new affordable housing and promote community development,” Representative Nancy Pelosi, Democrat of California and the minority leader, said in a statement. She added, “The omnibus also rejects the Trump administration’s cruel anti-immigrant agenda.”Mr. Trump said on Friday afternoon that it was Democrats who had balked at including an extension of DACA in the spending bill, claiming that Republicans wanted to protect immigrants from deportation but were blocked by Democrats.In fact, over the weekend, the White House offered to extend protections for hundreds of thousands of current DACA recipients for two and a half years, with no guarantee beyond that time, in exchange for $25 billion for the border wall, according to congressional aides.Democrats countered by saying they would agree to the full $25 billion only if the president agreed to a pathway to citizenship for a much broader population of young immigrants brought to the country illegally as children, well over a million people — a deal that was similar to an earlier offer from Mr. Trump.The White House rejected the Democratic offer.